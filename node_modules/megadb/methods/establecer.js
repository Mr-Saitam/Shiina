const { saveJSON, isObject } = require("../utils/utilidades.js")

module.exports = {
	establecer: function (clave, valor, split_object, global_object, self, save) {

		var [...args] = clave.split(split_object)
		var object_data = global_object[self.object_id]

		for(var key of args) {
			if(key == args[args.length-1]) {
				object_data[key] = valor
				break
			}
			if(!object_data.hasOwnProperty(key)) object_data = object_data[key] = {}
			else object_data = !isObject(object_data[key]) ? object_data[key] = {} : object_data[key]
		}

		if(!save) return Promise.resolve(global_object[self.object_id])
		saveJSON(self, global_object[self.object_id])
		return Promise.resolve(global_object[self.object_id])
	}
}
