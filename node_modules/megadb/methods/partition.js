const { check_path_object } = require("../utils/utilidades.js"),
				errorDB = require("../class/errorDB.js");

module.exports = {
	partition: function (clave, callback, split_object, global_object, self) {

    let partition = [new Object(), new Object()]

	  if(clave === false) {
	    for(var key in global_object[self.object_id]) {
        if(callback(global_object[self.object_id][key], key)) partition[0][key] = global_object[self.object_id][key]
        else partition[1][key] = global_object[self.object_id][key]
	    }
	    return Promise.resolve(partition)
	  }
	  check_path_object(clave, split_object, 'partition', callback)

	  var [...args] = clave.split(split_object)
		var object_data = global_object[self.object_id]
		
	  for(var key of args) {
			if(!object_data.hasOwnProperty(key)) return Promise.reject(new errorDB(`No se encontro la propiedad ${key}, base de datos: ${self.database_name}`, 'PROPIEDAD NO EXISTENTE', 'partition', clave, callback))
			if(key == args[args.length-1]) {
				for(var key2 in object_data[key]) {
          if(callback(object_data[key][key2], key2)) partition[0][key2] = object_data[key][key2]
          else partition[1][key2] = object_data[key][key2]
				}
				return Promise.resolve(partition)
			}
			else {
				object_data = object_data[key]
			}
	  }
	}
}